#!/bin/bash

if [ "aa$1" == "aa--skip-disclaimer" ]; then
	SKIPDISCLAIMER="yes"
else
	SKIPDISCLAIMER="no"
fi

modules=`ls -d kernel/ez*`;

mkdir -p ./update/generated;

rm -f ./update/generated/publish_postgresql.sql
rm -f ./update/generated/publish_mysql.sql

if [ $SKIPDISCLAIMER == "no" ]; then
	echo "
-- ################################################################
-- # Do not edit this file manually. This file is generated by    #
-- # make_sql.sh                                                  #
-- #                                                              #
-- # Any changes to this file will be lost in the release         #
-- # edit [modulename]/sql/postgresql/[modulenname].sql instead   #
-- ################################################################
" >> ./update/generated/publish_postgresql.sql

	echo "
-- ################################################################
-- # Do not edit this file manually. This file is generated by    #
-- # make_sql.sh                                                  #
-- #                                                              #
-- # Any changes to this file will be lost in the release         #
-- # edit [modulename]/sql/mysql/[modulenname].sql instead        #
-- ################################################################
" >> ./update/generated/publish_mysql.sql
fi


for moduleDir in $modules
do
    module="${moduleDir##*/}";
    if [ -f kernel/$module/sql/postgresql/$module.sql ]
	then cat kernel/$module/sql/postgresql/$module.sql >> ./update/generated/publish_postgresql.sql
    fi
    if [ -f kernel/$module/sql/mysql/$module.sql ]
	then cat kernel/$module/sql/mysql/$module.sql >> ./update/generated/publish_mysql.sql
    fi
done


if [ $SKIPDISCLAIMER == "no" ]; then
	echo "
-- ################################################################
-- # Do not edit this file manually. This file is generated by    #
-- # make_sql.sh                                                  #
-- #                                                              #
-- # Any changes to this file will be lost in the release         #
-- # edit [modulename]/sql/postgresql/[modulenname].sql instead   #
-- ################################################################
" >> ./update/generated/publish_postgresql.sql

	echo "
-- ################################################################
-- # Do not edit this file manually. This file is generated by    #
-- # make_sql.sh                                                  #
-- #                                                              #
-- # Any changes to this file will be lost in the release         #
-- # edit [modulename]/sql/mysql/[modulenname].sql instead        #
-- ################################################################
" >> ./update/generated/publish_mysql.sql
fi

